# GitHub Ruleset Configuration for Main Branch Protection
# ğŸš€ Configure in GitHub: Settings > Rules > Rulesets > New branch ruleset

# === BASIC CONFIGURATION ===
ruleset_name: "Main Branch Protection - Satellite Image API"
enforcement_status: "Active"  # Active | Evaluate | Disabled
target_branches: "~DEFAULT_BRANCH"  # Targets main/master branch automatically

# === BRANCH RULES TO ENABLE ===

# âœ… CRITICAL PROTECTIONS
restrict_deletions: true           # âœ… Only allow users with bypass permission to delete
block_force_pushes: true          # âœ… Prevent force pushes
require_pull_request: true        # âœ… Require PRs before merging

# âœ… PULL REQUEST REQUIREMENTS
pr_settings:
  required_approving_review_count: 1
  dismiss_stale_reviews_on_push: true
  require_code_owner_review: false
  require_last_push_approval: false        # Set to true for extra security
  required_review_thread_resolution: true

# âœ… STATUS CHECKS (CRITICAL FOR CI)
require_status_checks: true
status_checks_must_be_up_to_date: true    # Require branches to be current
required_status_checks:
  - "code-quality"    # Matches workflow job name
  - "security"        # Matches workflow job name
  - "test"           # Matches workflow job name

# âœ… COMMIT QUALITY
require_linear_history: true              # Prevent messy merge commits
commit_message_pattern: |
  ^(build|chore|ci|docs|feat|fix|perf|refactor|revert|style|test)(\\([a-z0-9-]+\\))?(!)?: .{1,100}
  # Enforces conventional commits: feat: add new feature

# âš ï¸  OPTIONAL RULES (Enable as needed)
require_signed_commits: false             # Enable for high-security projects
require_deployments_to_succeed: false     # Enable if using GitHub deployments
require_code_scanning: false              # Enable for advanced security scanning

# === BYPASS LIST ===
# Organization/Repository admins can bypass by default
# Add specific users/teams/apps if needed in the GitHub UI

# === ğŸ”§ SETUP INSTRUCTIONS ===
# 1. Go to: Repository Settings â†’ Rules â†’ Rulesets
# 2. Click: "New branch ruleset"
# 3. Copy settings from this file:
#    - Name: "Main Branch Protection - Satellite Image API"
#    - Target: "Default branch"
#    - Enforcement: "Active"
# 4. Enable Branch Rules:
#    â˜‘ï¸ Restrict deletions
#    â˜‘ï¸ Block force pushes
#    â˜‘ï¸ Require linear history
#    â˜‘ï¸ Require a pull request before merging (1 approval, dismiss stale reviews)
#    â˜‘ï¸ Require status checks to pass (code-quality, security, test)
# 5. Optional: Add conventional commit pattern
# 6. Save ruleset

# === ğŸ“‹ VERIFICATION CHECKLIST ===
# After setup, verify:
# â˜‘ï¸ Direct pushes to main are blocked
# â˜‘ï¸ PRs require 1 approval
# â˜‘ï¸ All 3 status checks must pass
# â˜‘ï¸ Branches must be up-to-date before merge
# â˜‘ï¸ Force pushes are blocked
# â˜‘ï¸ Branch deletions are blocked
